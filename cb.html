
<!doctype html> 
<html> 
  <head> 
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
    <link type="text/css" rel="stylesheet" href="css/jquery-ui-cb.css">
    <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> -->
    <link rel="stylesheet" href="lib/treeview/jquery.treeview.css" />
    <link type="text/css" rel="stylesheet" href="css/cb.css">

    <title>Code Browser Experiment</title> 
    <link rel='shortcut icon' type='image/x-icon' href='img/favicon.png' /> 
  </head> 
 
  <body> 
    <script src="lib/jquery.js"></script>
    <script src="lib/jquery-ui-1.8.16.custom.min.js"></script>
    <script src="lib/treeview/lib/jquery.cookie.js" type="text/javascript"></script>
    <script src="lib/ace-0.2.0/src/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/ace-0.2.0/src/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/ace-0.2.0/src/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script src="lib/treeview/jquery.treeview.js" type="text/javascript"></script>

    <script src="js/cb.js"></script>
    <script>

        function handle_content(content, label) {
          //console.log(content);
          var lines = content.split('\n');
          //console.log(lines);
          var doc = {
            icon: 'root',
            label: label,
            children: [],
            text: ''
          };

          var stack = [ doc ];
          var row = -1;
          $.each(lines, function(index, line) {
            row = row+1;
            var h5 = line.substr(0, 5);
            var h6 = line.substr(0, 6);
            if( h6 === '#[of]:' ) {
              line = line.substr(6);
              var item = { icon: 'fold', label: line, row: row, children: [], text:'' };
              var parent = stack[stack.length-1];
              parent.children.push(item);
              stack.push(item);
            }
            else if( h5 === '#[cf]') {
              stack.pop();
            }
            else {
              var parent = stack[stack.length-1];
              parent.text = parent.text + line + '\n';
            }
          });

          console.log('**');
          console.log(JSON.stringify(doc));
          console.log('**');

          $('#file').hide();
          $('#cb').codeBrowser({
            document: doc
          });
        }


        function handle_files(files) {
          for (var i = 0; i < files.length; i++) {
            var file = files[i];
            var reader = new FileReader();
            reader.onload = function(evt) {
              var content = evt.target.result;
              handle_content(content, file.name);
            };
            reader.onerror = function(evt) {
              console.error(evt.target.error)
            }
            reader.readAsText(file, "UTF-8");
          }
        }

        $(document).ready(function() {

        
          var content = "#[of]:Home\n" +
                        "#[of]:About\n" +
                        "Code Browser is a folding text editor for Linux and Windows, designed to hierarchically structure any kind of text file and especially source code. \n" +
                        "It makes navigation through source code faster and easier.\n" +
                        "\n" +
                        "Code Browser is especially designed to keep a good overview of the code of large projects, \n" +
                        "but is also useful for a simple css file. Ideal if you are fed up of having to scroll through thousands of lines of code.\n" +
                        "\n" +
                        "See the Introduction to Code Folding page if you want more information on text folding and the way it is implemented in Code Browser.\n" +
                        "\n" +
                        "It supports syntax highlighting for all major languages and custom syntax highlighting can also be added.\n" +
                        "\n" +
                        "Although Code Browser was initially designed to edit programs, it can also be used for different tasks such as plain text \n" +
                        "outlining or helping to understand existing source code. I've added a page with suggestions to take advantage of folding.\n" +
                        "#[cf]\n" +
                        "#[of]:License\n" +
                        "Code Browser is released under the GPL v2 License.\n" +
                        "#[cf]\n" +
                        "\n" +
                        "#[cf]\n";

          handle_content(content, 'test');

        });
    </script>

    <div class="body">
      <!-- <input id="file" type="file" multiple="multiple" onchange="handle_files(this.files)"> -->
      <div id="cb" class="cb-frame"></div>
    </div>

  </body> 
</html> 
